<!DOCTYPE html>
<html>
<head>
    <title>Chat - Client</title>
    <style>
        #messages {
            height: 400px;
            overflow-y: auto;
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div id="messages"></div>
    <input type="text" id="messageInput" placeholder="Type a message...">
    <button onclick="sendMessage()">Send</button>

    <script>
        let ws;
        let partnerId;
        
        function connect() {
            ws = new WebSocket(`wss://${window.location.host}`);
            
            ws.onopen = () => {
                console.log('Connected to server');
                // 获取URL中的ID参数
                const urlParams = new URLSearchParams(window.location.search);
                partnerId = urlParams.get('id');
            };
            
            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                
                if (data.type === 'id') {
                    // 保存自己的ID
                    myId = data.id;
                } else if (data.type === 'message') {
                    // 显示接收到的消息
                    const messagesDiv = document.getElementById('messages');
                    messagesDiv.innerHTML += `<p><strong>Partner:</strong> ${data.content}</p>`;
                    messagesDiv.scrollTop = messagesDiv.scrollHeight;
                }
            };
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (message && partnerId) {
                ws.send(JSON.stringify({
                    targetId: partnerId,
                    content: message
                }));
                
                const messagesDiv = document.getElementById('messages');
                messagesDiv.innerHTML += `<p><strong>You:</strong> ${message}</p>`;
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
                
                input.value = '';
            }
        }

        connect();
    </script>
</body>
</html>
